<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Carbon Sink Tracker</title>
    <meta name="description" content="Carbon Sink Tracker - Interactive Land Use Land Cover mapping and analytics for Gujarat" />
    <meta name="keywords" content="carbon sink, LULC, land use, land cover, Gujarat, mapping, analytics" />
    <meta name="author" content="Carbon Sink Tracker" />
    <link rel="icon" type="image/svg+xml" href="logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Dynamic base path for static files -->
    <script>
      // Detect protocol and set base path (declare once, used globally)
      window.isFileProtocol = window.location.protocol === 'file:';
      window.STATIC_BASE = window.isFileProtocol ? '' : '/static';
      // Load CSS with correct path
      const cssPath = window.isFileProtocol ? 'styles.css' : '/static/styles.css';
      document.write(`<link rel="stylesheet" href="${cssPath}" />`);
    </script>
  </head>
  <body>
    <!-- Statistics Box -->
    <!-- (Removed Carbon Sink Area stats box) -->
    
    <div id="controls">
      <div id="header-container">
        <img id="logo" alt="Logo" />
        <h2>Carbon Sink Tracker</h2>
      </div>
      <div class="multiselect-wrapper">
        <label><b>District:</b></label><br />
        <button type="button" id="districtDropdownBtn">Select district(s)</button>
        <div id="districtDropdown" class="multiselect-dropdown" style="display:none;">
          <div id="district-checkboxes"></div>
        </div>
      </div>

      <label
        ><b>Filter:</b>
        <br />
        <select id="lulcFilter">
          <option value="all">LULC</option>
          <option value="forest">Carbon Sink</option>
        </select>
      </label>
      <label for="yearSlider"
        ><b>Year:</b><br />
        <div id="yearSliderContainer">
          <input
            type="range"
            id="yearSlider"
            min="2011"
            max="2022"
            step="1"
            value="2022"
          />
          <span id="yearDisplay">2022</span>
        </div></label
      >
      <div class="button-row">
        <button id="submitBtn" onclick="loadLULC()" class="load-btn">
          Load
        </button>
        <button onclick="clearLULC()" class="clear-btn">
          Clear
        </button>
      </div>
      <div class="button-row">
        <button onclick="downloadLULC()" class="download-btn">
          Download
        </button>
      </div>
      
      <!-- Animation Controls -->
      <div class="animation-controls">
        <h3>Carbon Sink Timeline</h3>
        <div class="animation-row">
          <button id="initAnimationBtn" onclick="initializeAnimation()" class="init-btn">üöÄ Load Animation</button>
          <button id="playBtn" onclick="toggleAnimation()" class="play-btn" style="display: none;">‚ñ∂Ô∏è Play</button>
          <span id="currentYear" style="display: none;">2022</span>
        </div>
        <div class="year-slider-container" style="display: none;">
          <input type="range" id="animationSlider" min="2015" max="2022" value="2022" step="1">
        </div>
      </div>
      
      <br />
    </div>
    <div id="map"></div>
    
    <!-- Right Slider Panel -->
    <div id="right-panel" class="right-panel">
      <div class="panel-header">
        <h3>Analytics</h3>
        <button id="close-panel" class="close-btn">&times;</button>
      </div>
      <div class="panel-content">
        <div class="graph-toggles">
          <button class="graph-toggle active" data-graph="1">State</button>
          <button class="graph-toggle" data-graph="2">District</button>
        </div>
        
        <!-- State Section -->
        <div class="graph-section active" id="state-section">
          <!-- State Graph Toggle Buttons -->
          <div class="state-graph-toggles">
            <button class="state-graph-toggle active" data-state-graph="forest">Forest</button>
            <button class="state-graph-toggle" data-state-graph="wetland">Wetland</button>
            <button class="state-graph-toggle" data-state-graph="total">Total</button>
          </div>
          
          <div class="graphs-container">
            <div class="graph-chart-container active" id="state-forest-container">
              <h4>Forest CO2e Emissions</h4>
              <canvas id="stateForestChartCanvas"></canvas>
            </div>
            <div class="graph-chart-container" id="state-wetland-container">
              <h4>Wetland CO2e Emissions</h4>
              <canvas id="stateWetlandChartCanvas"></canvas>
            </div>
            <div class="graph-chart-container" id="state-total-container">
              <h4>Total CO2e Emissions (Forest + Wetland)</h4>
              <canvas id="stateCombinationChartCanvas"></canvas>
            </div>
          </div>
        </div>
        
        <!-- District Section -->
        <div class="graph-section" id="district-section">
          <!-- District Graph Toggle Buttons -->
          <div class="district-graph-toggles">
            <button class="district-graph-toggle active" data-district-graph="forest">Forest</button>
            <button class="district-graph-toggle" data-district-graph="wetland">Wetland</button>
            <button class="district-graph-toggle" data-district-graph="total">Total</button>
          </div>
          
          <div class="graphs-container">
            <div class="graph-chart-container active" id="district-forest-container">
              <h4>Forest CO2e Emissions by District</h4>
              <canvas id="districtForestChartCanvas"></canvas>
            </div>
            <div class="graph-chart-container" id="district-wetland-container">
              <h4>Wetland CO2e Emissions by District</h4>
              <canvas id="districtWetlandChartCanvas"></canvas>
            </div>
            <div class="graph-chart-container" id="district-total-container">
              <h4>Total CO2e Emissions by District (Forest + Wetland)</h4>
              <canvas id="districtCombinationChartCanvas"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Chart Icon Button -->
    <button id="chart-icon" class="chart-icon">üìä</button>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <!-- Configure API base URL (reusing static paths already set) -->
    <script>
      // Set API base URL using the already-defined window.isFileProtocol
      window.API_BASE = window.isFileProtocol ? 'http://localhost:8000' : (window.location.hostname === 'localhost' ? 'http://localhost:8000' : "");
    </script>
    <script>
      // Set logo path and load main.js
      window.addEventListener('DOMContentLoaded', function() {
        const logoImg = document.getElementById('logo');
        if (logoImg) {
          // Use relative path for file://, absolute path for server
          logoImg.src = window.isFileProtocol ? 'logo.svg' : '/static/logo.svg';
        }
      });
      // Dynamically load main.js with correct path
      const script = document.createElement('script');
      script.src = window.isFileProtocol ? 'main.js' : '/static/main.js';
      document.body.appendChild(script);
    </script>
  </body>
</html>
